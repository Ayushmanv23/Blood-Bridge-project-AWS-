{% extends "base.html" %}

{% block content %}
<div class="header-section mb-1">
    <h1>Dashboard</h1>
    <p>Welcome, <span style="color: var(--primary); font-weight: bold;">{{ username }}</span> ({{ role|title }})</p>
</div>

<!-- ================= DONOR VIEW ================= -->
{% if role == 'donor' %}
<div class="grid">
    <div class="card">
        <h3>My Profile</h3>
        <p><strong>Blood Group:</strong>
            <span style="color: var(--primary); font-size: 1.2rem;">
                {{ user_data.get('blood_group', 'N/A') }}
            </span>
        </p>
        <p><strong>Last Donation:</strong> {{ user_data.get('last_donation', 'N/A') }}</p>
        <div class="mt-1">
            <span class="btn btn-outline">Eligibility: Eligible</span>
        </div>
    </div>

    <div class="card" style="grid-column: span 2;">
        <h3>Urgent Blood Requests</h3>
        <p class="form-label mb-1">Nearby hospitals need your help!</p>

        <div style="display: flex; flex-direction: column; gap: 1rem;">
            {% for req in requests %}
            <div
                style="background: rgba(255,255,255,0.05);
                       padding: 1rem;
                       border-radius: 8px;
                       border-left: 4px solid {% if req.urgency == 'High' %}var(--danger){% else %}var(--warning){% endif %};
                       display: flex;
                       justify-content: space-between;
                       align-items: center;">
                <div>
                    <h4 style="margin: 0;">
                        {{ req.blood_group }} needed at {{ req.requested_by }}
                    </h4>
                    <small style="color: var(--text-muted);">
                        Urgency: {{ req.urgency }} | Quantity: {{ req.quantity }} units
                    </small>
                </div>

                <!-- âœ… FIXED DONATE BUTTON -->
                <a href="{{ url_for('inventory_page', from_donate='true') }}"
                   class="btn btn-primary"
                   style="padding: 0.4rem 1rem; font-size: 0.8rem;">
                    Donate Now
                </a>
            </div>
            {% else %}
            <p>No active requests at the moment.</p>
            {% endfor %}
        </div>
    </div>
</div>

<!-- ================= HOSPITAL VIEW ================= -->
{% elif role == 'hospital' %}
<div class="grid">
    <div class="card" style="grid-column: span 2;">
        <h3>Find Donors</h3>
        <form action="{{ url_for('dashboard') }}" method="GET" style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <input type="hidden" name="search" value="true">
            <input type="text" name="state" class="form-control" placeholder="State">
            <input type="text" name="area" class="form-control" placeholder="Area">
            <select name="blood_group" class="form-control">
                <option value="">Any Blood Group</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
            </select>
            <button type="submit" class="btn btn-outline">Search</button>
        </form>
    </div>

    <div class="card">
        <h3>Submit Blood Request</h3>
        <form action="{{ url_for('add_request') }}" method="POST">
            <select name="blood_group" class="form-control">
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
            </select>
            <input type="number" name="quantity" class="form-control mt-1" min="1" required>
            <select name="urgency" class="form-control mt-1">
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
            </select>
            <button type="submit" class="btn btn-primary mt-1">Request Blood</button>
        </form>
    </div>
</div>

<!-- ================= BLOOD BANK VIEW ================= -->
{% elif role == 'blood_bank' %}
<div class="card">
    <h3>Inventory Overview</h3>
    <a href="{{ url_for('inventory_page') }}" class="btn btn-outline">Update Stock</a>
</div>
{% endif %}

{% endblock %}
